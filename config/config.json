{
	"jobs": {
		"normalizeVenue": {
			"input": {
				"type": "mongodb",
				"connection":{
					"url": "mongodb://bdaserver/",
					"options":{}
				},
				"db": "xueersi6",
				"collection": "class",
				"op":{
					"name":"find",
					"query": {"cla_term_name": {"$in": ["春季班","秋季班","寒假班","暑期班"]}, "clsType":{"$ne":"在线"}},
					"options":{
						"projection": {"cla_start_date": 1, "cla_term_name": 1,"cla_subject_names": 1, "_id": 0, "cla_venue_id": 1, "cla_venue_name": 1, "clsType":1, "city": 1, "createdAt": 1, "updatedAt": 1}
					}
				}
			},
			"output": {
				"type": "mongodb",
				"url": "mongodb://bdaserver/",
				"db": "xueersi6",
				"collection": "venue",
				"key":["venueId", "city", "clsType"],
				"updateKeys": ["venueName", "updatedAt"],
				"insertKeys": ["createdAt", "termYear", "termSeason"]
			}
		},
		"normalizeClassroom": {
			"input": {
				"type": "mongodb",
				"connection":{
					"url": "mongodb://bdaserver/",
					"options":{}
				},
				"db": "xueersi6",
				"collection": "class",
				"op":{
					"name":"find",
					"query": {"cla_term_name": {"$in": ["春季班","秋季班","寒假班","暑期班"]}, "clsType":{"$ne":"在线"}},
					"options":{
						"projection": {"cla_start_date": 1, "cla_term_name": 1,"cla_subject_names": 1, "_id": 0, "cla_venue_id": 1, "cla_venue_name": 1, "clsType":1, "city": 1, "cla_classroom_name": 1, "createdAt": 1, "updatedAt": 1}
					}
				}
			},
			"output": {
				"type": "mongodb",
				"url": "mongodb://bdaserver/",
				"db": "xueersi6",
				"collection": "classroom",
				"key":["venueId", "city", "clsType", "classroom"],
				"updateKeys": ["venueName", "updatedAt"],
				"insertKeys": ["createdAt", "termYear", "termSeason"]
			}
		},
		"newVenueByTerm": {
			"input": {
				"type": "mongodb",
				"connection":{
					"url": "mongodb://bdaserver/",
					"options":{}
				},
				"db": "xueersi6",
				"collection": "venue",
				"op":{
					"name":"find",
					"query": {},
					"options":{
						"projection": {}
					}
				}
			},
			"output": {
				"type": "csv",
				"dir": "/data/xueersi-utils/",
				"name": "newVenueByTerm",
				"fields": ["indicator","city", "clsType", "termYear", "termSeason", "value"]
			}
		},
		"newClassroomByTerm": {
			"input": {
				"type": "mongodb",
				"connection":{
					"url": "mongodb://bdaserver/",
					"options":{}
				},
				"db": "xueersi6",
				"collection": "classroom",
				"op":{
					"name":"find",
					"query": {},
					"options":{
						"projection": {}
					}
				}
			},
			"output": {
				"type": "csv",
				"dir": "/data/xueersi-utils/",
				"name": "newClassroomByTerm",
				"fields": ["indicator","city", "clsType", "termYear", "termSeason", "value"]
			}
		},
		"venueClassroomCaptured": {
			"input": {
				"type": "mongodb",
				"connection":{
					"url": "mongodb://bdaserver/",
					"options":{}
				},
				"db": "xueersi6",
				"collection": "class",
				"op":{
					"name":"find",
					"query": {},
					"options":{
						"projection": {"cla_id":1, "cla_start_date": 1, "cla_term_name": 1, "_id": 0, "cla_venue_id": 1, "cla_venue_name": 1, "clsType":1, "city": 1,"cla_classroom_name": 1, "createdAt": 1, "updatedAt": 1}
					}
				}
			},
			"output": {
				"type": "csv",
				"dir": "/data/xueersi-utils/",
				"name": "venueClassroomCaptured",
				"fields": ["indicator","city", "clsType", "termYear", "termSeason", "value"]
			}
		},
		"transformEnrollment": {
			"input": {
				"type": "mongodb",
				"connection":{
					"url": "mongodb://bdaserver/",
					"options": {}
				},
				"db": "xueersi6",
				"collection": "class",
				"op":{
					"name":"find",
					"query": {},
					"options":{
						"projection": {}
					}
				}
			},
			"output": {
				"type": "mongodb",
				"url": "mongodb://bdaserver/",
				"db": "xueersi6",
				"collection": "class_transformedEnrollment",
				"op": "insert"
			}
		},
		"regularCourse": {
			"input": {
				"type": "mongodb",
				"connection":{
					"url": "mongodb://bdaserver/",
					"options": {}
				},
				"db": "xueersi6",
				"collection": "class_transformedEnrollment",
				"op": {
					"name": "find",
					"query": {
						"cla_term_name": {"$in": ["春季班","秋季班","寒假班","暑期班"]},
						"clsType":"在线",
						"city":"广州"
					},
					"options":{
						"limit": 10000,
						"projection": {"_id":0, "tutor_picture_url":0, "cla_live_class_template_id":0, "crc_regist_count":0, "cla_level_id":0, "cla_class_type":0, "tea_picture_url":0,"cla_live_class_time_id":0, "cla_subject_ids":0, "cla_area_id":0, "cla_is_double_teacher_live_class":0, "dept_name":0, "cla_is_live_class":0, "cla_gt_id":0,"cla_recommend_number_MD5":0, "cla_term_id":0, "cla_grade_id":0, "show_teacher_list":0, "regist_Time":0, "domain":0, "cla_quota_num":0, "groupId":0, "gradeId":0,"page":0, "cityCode":0, "isOpen":0,"cla_name":0, "cla_tutor_real_name":0, "tea_teacher_name":0, "cla_year":0, "cla_level_name":0, "cla_teacher_names":0, "cla_area_name":0,"dept_id":0, "tea_id":0,"cla_venue_id":0,"":0, "d_name":0,"cla_classtime_names":0,"cla_classroom_name":0, "cla_grade_name":0,"cla_price":0, "cla_surplus_persons":0, "cla_tutor_id":0,"cwc_waitcount":0, "order":0, "term_type":0, "cla_venue_name":0, "cla_class_count": 0, "course_regist_count":0, "createdAt":0, "updatedAt": 0, "termId": 0, "courseTypeId": 0}
					}
				}
			},
			"output": {
				"type": "csv",
				"dir": "/data/xueersi-utils/",
				"name": "regularCourse",
				"fields": ["indicator","dimensionName", "dimensionValue","clsType", "termYear", "termSeason", "value"]
			}
		},
		"income": {
			"input": {
				"type": "mongodb",
				"connection": {
					"url": "mongodb://bdaserver/",
					"options": {}
				},
				"db": "xueersi6",
				"collection": "class_transformedEnrollment",
				"op": {
					"name": "aggregate",
					"pipeline": [
						{"$match": {"cla_year": "2017"}},
						{"$project": {"_id":0, "tutor_picture_url":0, "cla_live_class_template_id":0, "crc_regist_count":0, "cla_level_id":0, "cla_class_type":0, "tea_picture_url":0,"cla_live_class_time_id":0, "cla_subject_ids":0, "cla_area_id":0, "cla_is_double_teacher_live_class":0, "dept_name":0, "cla_is_live_class":0, "cla_gt_id":0,"cla_recommend_number_MD5":0, "cla_term_id":0, "cla_grade_id":0, "show_teacher_list":0, "regist_Time":0, "domain":0, "cla_quota_num":0, "groupId":0, "gradeId":0,"page":0, "cityCode":0, "isOpen":0,"cla_name":0, "cla_tutor_real_name":0, "tea_teacher_name":0, "cla_year":0, "cla_level_name":0, "cla_teacher_names":0, "cla_area_name":0,"dept_id":0, "tea_id":0,"cla_venue_id":0, "d_name":0,"cla_classroom_name":0, "cla_grade_name":0, "cla_surplus_persons":0, "cla_tutor_id":0,"cwc_waitcount":0, "order":0, "term_type":0, "cla_venue_name":0, "course_regist_count":0, "createdAt":0, "updatedAt": 0, "termId": 0, "courseTypeId": 0, "levelId":0, "levels":0, "grade":0,"cla_max_persons":0,"term":0,"cla_classtime_names":0,"subjectId": 0}},
						{"$lookup":{
							"from": "ctable",
							"localField": "cla_id",
							"foreignField": "cla_id",
							"as": "timeTable"
						}
					}],
					"options": {
						
					}
				}
			},
			"output": {
				"type": "csv",
				"dir": "/data/xueersi-utils/",
				"name": "income",
				"fields": ["indicator","dimensionName", "dimensionValue","clsType", "termYearOfCourse","termSeasonOfCourse","termYearOfLesson", "termSeasonOfLesson", "value"]
			}
		},
		"onlineASP": {
			"input": {
				"type": "mongodb",
				"connection":{
					"url": "mongodb://bdaserver/",
					"options": {}
				},
				"db": "xueersi6",
				"collection": "class_transformedEnrollment",
				"op":{
					"name":"find",
					"query": {
						"clsType": { "$in": ["在线"]}
					},
					"options":{
						"projection": {"_id":0, "tutor_picture_url":0, "cla_live_class_template_id":0, "crc_regist_count":0, "cla_level_id":0, "cla_class_type":0, "tea_picture_url":0,"cla_live_class_time_id":0, "cla_subject_ids":0, "cla_area_id":0, "cla_is_double_teacher_live_class":0, "dept_name":0, "cla_is_live_class":0, "cla_gt_id":0,"cla_recommend_number_MD5":0, "cla_term_id":0, "cla_grade_id":0, "show_teacher_list":0, "regist_Time":0, "domain":0, "cla_quota_num":0, "groupId":0, "gradeId":0,"page":0, "cityCode":0, "isOpen":0, "cla_tutor_real_name":0, "tea_teacher_name":0, "cla_year":0, "cla_level_name":0, "cla_teacher_names":0, "cla_area_name":0,"dept_id":0, "tea_id":0,"cla_venue_id":0,"":0, "d_name":0,"cla_classroom_name":0, "cla_grade_name":0, "cla_surplus_persons":0, "cla_tutor_id":0,"cwc_waitcount":0, "order":0, "term_type":0, "cla_venue_name":0, "course_regist_count":0, "createdAt":0, "updatedAt": 0, "termId": 0, "courseTypeId": 0}
					}
				}
			},
			"output": {
				"type": "csv",
				"dir": "/data/xueersi-utils/",
				"name": "onlineASP",
				"fields": ["cla_id","cla_name","cla_end_date", "courseId", "capacity","cla_class_count","startDate","cla_price","termName","clsType","city","group","grade","term","cla_price","courseType","duration","termYear","termSeason","subject","finalEnrollment","hourName"]
			}
		}
	}
}
